---
title: "Evolution of the minimal cell - growth curves"
author: "Jay T. Lennon"
#date: "`r format(Sys.time(), '%d %B, %Y')`"
#header-includes:
#   - \usepackage{array}
#output: pdf_document
#geometry: margin=2.54cm
output: html_notebook
editor_options:
  code_folding: hide
  chunk_output_type: inline
---


## Clear workspace and set directory
```{r setup, include=FALSE, echo=FALSE}
rm(list=ls())
getwd()
setwd("~/GitHub/MinimalCell") 
```

## Load packages and functions
```{r}
library("here")
library("tidyverse")
library("lubridate")
library("broom")
library("cowplot")
```

## Read data from plate file  

```{r, message=FALSE}

# load data


xpt.file <- here("datafiles", "minimal.growth.415b.txt")

xpt.reads = grep("Reads", readLines(xpt.file), value = T)%>%
  str_remove(pattern = ".*,") %>% parse_number()

# start line of OD table
start.line = grep("^Time.*A1", readLines(xpt.file))

# end line of OD table
aprox.end.line.n= floor(start.line+xpt.reads)-start.line



#xpt.reads = grep("Reads", readLines(xpt.file), value = T)%>%
#  str_remove(pattern = ".*,") %>% parse_number()

#con <- file(xpt.file, open="r", encoding="UTF-8")


# number of times plate was read
#xpt.reads = grep("Reads", readLines(con), value = T)%>%
#  str_remove(pattern = ".*,") %>% parse_number()

# start line of absorbance table
#start.line = grep("^Time.*A1", readLines(con = con))

# end line of absorbance table
aprox.end.line.n= floor(start.line+xpt.reads)-start.line

# start line of OD table
start.line = grep("^Time.*A1", readLines(xpt.file))

# end line of OD table
aprox.end.line.n= floor(start.line+xpt.reads)-start.line





# number of times plate was read
xpt.reads = grep("Reads", readLines(xpt.file), value = T)%>%
  str_remove(pattern = ".*,") %>% parse_number()

# start line of absorbance table
start.line = grep("^Time.*A1", readLines(con = con))

# end line of absorbance table
aprox.end.line.n= floor(start.line+xpt.reads)-start.line

# read data and organize it
input <- 
  read_tsv(xpt.file,
       skip = start.line-1,
       n_max = aprox.end.line.n-1,
       col_types = cols(Time = "c"))%>%
  # rename temp column
    rename("temp"=2)%>%
  # Convert time to hms
    mutate(Time=lubridate::hms(Time))%>%
    mutate(Time=as.duration(Time))%>%
  # remove empty lines
    filter(Time != 0)
```


#xpt.file <- here("datafiles", "minimal.growth.daniel.txt")
#xpt.file <- read.delim("datafiles/minimal.growth.daniel.txt", sep="\t", header=FALSE)
#xpt.file <- read.table("datafiles/minimal.growth.daniel.txt", sep="\t")




## Mutation accumulation (MA)

# Load mutation rate data for Fig. 1A

```{r}
# Load mutation rate data
ma.raw <- read.csv("~/GitHub/MinimalCell/datafiles/MA_summary_for_R.csv", header = TRUE, sep =",")
