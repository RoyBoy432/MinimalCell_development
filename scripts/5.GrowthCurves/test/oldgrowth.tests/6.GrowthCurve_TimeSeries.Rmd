---
title: "Evolution of the minimal cell"
author: "Jay T. Lennon and Brent Lehmkuhl"
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes:
  - \usepackage{array}
output: pdf_document
geometry: margin=2.54cm
---

## Clear workspace and set directory
```{r setup}
rm(list=ls())
setwd("~/Github/MinimalCell/scripts/6.GrowthRates/test")
```

## Load packages and functions
```{r}
require("png")
require("dplyr")
require("grid")
sem <- function(x) sqrt(var(x)/length(x))
source("../bin/modified_Gomp.R")
```

# Load data
```{r}
# time 0 and time 300
t0 <- read.csv("../data/MinimalCell_TwoPoint_Mod.csv")
# Change times to numeric
t0$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t0$Time))

t0.nmin <- t0[3:which(t0[,1] == 15.00), c(1,2,6,10,14,18,22)]
t0.min <- t0[3:nrow(t0), c(1,3,7,11,15,19,23)]
t300.nmin <- t0[3:which(t0[,1] == 15.00), c(1,4,8,12,16,20,24)]
t300.nmin  <- t0[3:nrow(t0), c(1,5,9,13,17,21,25)]

# time 20
t20 <- read.csv("../data/T20.csv")
# Change times to numeric
t20$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t20$Time))
#head(GC, header = T)


```

# Run the Gompertz equation
```{r}
non.min.A.gomp <- growth.modGomp(input = non.min.A, output.name = "non.min.parms.Anc", 
               synergy = F, temp = F, smooth = T, trim = T)

min.A.gomp <- growth.modGomp(input = min.A, output.name = "min.parms.Anc", 
                                 synergy = F, temp = F, smooth = T, trim = T)

non.min.E.gomp <- growth.modGomp(input = non.min.E, output.name = "non.min.parms.Evo", 
                                 synergy = F, temp = F, smooth = T, trim = T)

min.E.gomp <- growth.modGomp(input = min.E, output.name = "min.parms.Evo", 
                             synergy = F, temp = F, smooth = T, trim = T)
```

# Initiate figure
```{r}

# wrangling
non.min.A.umax.mean <- mean(non.min.A.gomp[,4])
non.min.A.umax.sem <- sem(non.min.A.gomp[,4])

min.A.umax.mean <- mean(min.A.gomp[,4])
min.A.umax.sem <- sem(min.A.gomp[,4])

non.min.E.umax.mean <- mean(non.min.E.gomp[,4])
non.min.E.umax.sem <- sem(non.min.E.gomp[,4])

min.E.umax.mean <- mean(min.E.gomp[,4])
min.E.umax.sem <- sem(min.E.gomp[,4])

time <- c(1,4)
non.min.tab.mean <- rbind(non.min.A.umax.mean, non.min.E.umax.mean)
non.min.tab.sem <- rbind(non.min.A.umax.sem, non.min.E.umax.sem)
non.min.tab <- cbind(time, non.min.tab.mean, non.min.tab.sem)
colnames(non.min.tab) <- c("time", "mean", "sem")
rownames(non.min.tab) <- c("ancestor", "evolved")
non.min.tab <- as.data.frame(non.min.tab)
                     
min.tab.mean <- rbind(min.A.umax.mean, min.E.umax.mean)
min.tab.sem <- rbind(min.A.umax.sem, min.E.umax.sem)
min.tab <- cbind(time, min.tab.mean, min.tab.sem)
colnames(min.tab) <- c("time", "mean", "sem")
rownames(min.tab) <- c("ancestor", "evolved")     
min.tab <- as.data.frame(min.tab)


png(filename="~/GitHub/MinimalCell/scripts/6.GrowthRates/output/EndpointFig.png",
    width = 1200, height = 1200, res = 96*2) 

plot.new()
par(mar = c(7, 7, 5, 7))

# Add non-minimal points
plot(non.min.tab$time, non.min.tab$mean, xlim = c(0, 4.55), 
     ylim = c(0, 0.25), type = "p", pch = 21, bg = "blue", 
     col = "blue", cex = 2, ylab = "", xlab = "", 
     cex.lab = 1.5, las = 1, lwd = 2, yaxt = "n", xaxt = "n")
box(lwd=2)

# Add minimal points
points(min.tab$time, min.tab$mean, pch = 21, 
       bg = "red", col = "red", lwd = 2, cex = 2)

# Add error bars
arrows(x0 = non.min.tab$time, y0 = non.min.tab$mean, 
       y1 = non.min.tab$mean + non.min.tab$sem, 
       angle = 90, length = 0.1, lwd = 2, col = "blue")
arrows(x0 = non.min.tab$time, y0 = non.min.tab$mean, 
       y1 = non.min.tab$mean - non.min.tab$sem, 
       angle = 90, length=0.1, lwd = 2, col = "blue")
arrows(x0 = min.tab$time, y0 = min.tab$mean, 
       y1 = min.tab$mean + min.tab$sem, 
       angle = 90, length = 0.1, lwd = 2, col = "red")
arrows(x0 = min.tab$time, y0 = min.tab$mean, 
       y1 = min.tab$mean - min.tab$sem, 
       angle = 90, length=0.1, lwd = 2, col = "red")

# Add axes and labels
axis(side = 2, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     labels = c("0.5", "1.0", "1.5"), at = c(0.5, 1, 1.5))
axis(side = 4, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     at=c(0.5, 1, 1.5), labels = F)
axis(side = 3, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     at = c(1, 3), labels = F)
axis(side = 1, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     labels = c("Ancestor", "Evolved"), 
     col.axis = "darkgray", at = c(1, 3))
mtext(expression('Time'), side = 1,
      outer = TRUE, cex = 1.5, line = -3.5, adj = 0.45)
mtext(expression("Maximum growth rate (per day)"), side = 2, 
      outer = TRUE, cex = 1.5, line = -4, adj = 0.55)

# Add line segments
segments(non.min.tab$time[1], non.min.tab$mean[1], non.min.tab$time[2], 
         non.min.tab$mean[2], col = "blue", lwd = 2)
segments(min.tab$time[1], min.tab$mean[1], min.tab$time[2], 
         min.tab$mean[2], col = "red", lwd = 2)

# Add P-values
#mtext(expression("Timepoint:" ~italic("P")~"= 0.0003"), line = -2.5, cex = 0.80, at = 0.9)
#mtext(expression("Strain:" ~italic("P")~"< 0.0001"), line = -4.0, cex = 0.80, at = 0.75)

# Add strain identifier
#text(3.9, rel.fit.wt$mean[2], labels = "Non-minimal", cex = 1.0)
#text(3.8, rel.fit.min$mean[2], labels = "Minimal", cex = 1.0)

# Close Plot Device
dev.off()
graphics.off()

# Show Plot
img <- readPNG("~~/GitHub/MinimalCell/scripts/6.GrowthRates/output/EndpointFig.png")

grid.raster(img)
```