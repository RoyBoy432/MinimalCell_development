---
title: "Evolution of the minimal cell - Growth Curves"
author: "Jay T. Lennon and Brent Lehmkuhl"
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes:
  - \usepackage{array}
output: pdf_document
geometry: margin=2.54cm
---

## Clear workspace and set directory
```{r setup}
rm(list=ls())
setwd("~/Github/MinimalCell/scripts/6.GrowthRates/test")
```

## Load packages and functions
```{r}
require("png")
require("dplyr")
require("grid")
require("gtools")
#require("lme4")
#require("lmerTest")
require("nlme")
require("MuMIn")
source("../bin/modified_Gomp.R")
sem <- function(x) sqrt(var(x)/length(x))
cv <- function(x) 100*( sd(x)/mean(x))
```

# Load data and run Gompertz
```{r}

# t0 = day 0 --> Original ancestor run
# No JCVI positive control in this batch
t0.orig <- read.csv("../data/T0.orig.csv")

# Change times to numeric
t0.orig$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t0.orig$Time))
head(t0.orig, header = T)

# Pull out wells with minimal vs. non-minimal cells

nmin.orig.0 <- t0.orig [3:which(t0.orig[,1] == 15.00), c(1,2,6,10,14,18,22)]
min.orig.0 <- t0.orig[3:nrow(t0.orig), c(1,3,7,11,15,19,23)]
nmin.orig.300 <- t0.orig[3:which(t0.orig[,1] == 15.00), c(1,4,8,12,16,20,24)]
min.orig.300 <- t0.orig[3:nrow(t0.orig), c(1,5,9,13,17,21,25)]

#nmin.gomp.0.orig <- growth.modGomp(input = nmin.orig.0, output.name = "T0.orig.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.0.orig <- growth.modGomp(input = min.orig.0, output.name = "T0.orig.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.300.orig <- growth.modGomp(input = nmin.orig.300, output.name = "T300.orig.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.300.orig <- growth.modGomp(input = min.orig.300, output.name = "T300.orig.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

nmin.0.orig <- read.table("../output/T0.orig.nmin.parms.txt", sep=",", header=TRUE)
min.0.orig <- read.table("../output/T0.orig.min.parms.txt", sep=",", header=TRUE)
nmin.300.orig <- read.table("../output/T300.orig.nmin.parms.txt", sep=",", header=TRUE)
min.300.orig <- read.table("../output/T300.orig.min.parms.txt", sep=",", header=TRUE)
t0.orig.parms <- rbind(nmin.0.orig, min.0.orig, nmin.300.orig, min.300.orig)
t0.orig.parm.ord <- t0.orig.parms[mixedorder(t0.orig.parms$Curve),]
treats <- read.csv("../data/treatments_T0.orig.csv")
#treats.0.orig <- treats[which(treats$cell == "nm" | treats$cell == "m"),]
t0.orig.treats.combo <- cbind(t0.orig.parm.ord, treats)
t0.orig.treats.combo$Curve == t0.orig.treats.combo$well
# add small unit to distinguish from non-redone
#t0.orig.treats.combo$day <- t0.orig.treats.combo$day + 1.5

t0.orig.treats <- t0.orig.treats.combo[which(t0.orig.treats.combo$day == "0"),]
t300.orig.treats <- t0.orig.treats.combo[which(t0.orig.treats.combo$day == "300"),]

# t0 = day 0 
# No JCVI positive control in this batch
t0 <- read.csv("../data/T0.csv")

# Change times to numeric
t0$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t0$Time))
head(t0, header = T)

#ancestors
nmin <-  t0[3:nrow(t0), 
             c(1,2,6,10,14,18,22)]
min <- t0[3:nrow(t0), 
            c(1,3,7,11,15,19,23)]

# Run Gompertz (only need to run once then comment out)

#nmin.gomp.0 <- growth.modGomp(input = nmin, output.name = "T0.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.0 <- growth.modGomp(input = min, output.name = "T0.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

nmin.0 <- read.table("../output/T0.nmin.parms.txt", sep=",", header=TRUE)
min.0 <- read.table("../output/T0.min.parms.txt", sep=",", header=TRUE)
t0.parms <- rbind(nmin.0, min.0)
t0.parm.ord <- t0.parms[mixedorder(t0.parms$Curve),]

treats <- read.csv("../data/treatments_T0.csv")
treats.0 <- treats[which(treats$day == 0),]
t0.treats <- cbind(t0.parm.ord, treats.0)
t0.treats$Curve == t0.treats$well


# Ancestor redo: t0 = day 0

t0.redo <- read.csv("../data/T0.redo.csv")

# Change times to numeric
t0.redo$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t0.redo$Time))
head(t0.redo, header = T)

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t0.redo[3:nrow(t0.redo), c(1,2,8,14,20,26,32)]
pctrl <- t0.redo[3:nrow(t0.redo), c(1,3,9,15,21,27,33)]
nmin <-  t0.redo[3:nrow(t0.redo), 
             c(1,4,10,16,22,28,34,
                 5,11,17,23,29,35)]
min <- t0.redo[3:nrow(t0.redo), 
            c(1,6,12,18,24,30,36,
                7,13,19,25,31,37)]

# Run Gompertz (only need to run once then comment out)

#nmin.gomp.0.redo <- growth.modGomp(input = nmin, output.name = "T0.redo.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.0.redo <- growth.modGomp(input = min, output.name = "T0.redo.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

nmin.0.redo <- read.table("../output/T0.redo.nmin.parms.txt", sep=",", header=TRUE)
min.0.redo <- read.table("../output/T0.redo.min.parms.txt", sep=",", header=TRUE)
t0.redo.parms <- rbind(nmin.0.redo, min.0.redo)
t0.redo.parm.ord <- t0.redo.parms[mixedorder(t0.redo.parms$Curve),]
treats <- read.csv("../data/treatments_T0.redo.csv")
treats.0.redo <- treats[which(treats$cell == "nm" | treats$cell == "m"),]
t0.redo.treats <- cbind(t0.redo.parm.ord, treats.0.redo)
t0.redo.treats$Curve == t0.redo.treats$well
# add small unit to distinguish from non-redone
#t0.redo.treats$day <- t0.redo.treats$day + 0.5

# t10  = day 10
t10 <- read.csv("../data/T10.csv")

# Change times to numeric
t10$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t10$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t10[3:nrow(t10), c(1,2,12,22,32,42,52)]
pctrl <- t10[3:nrow(t10), c(1,3,13,23,33,43,53)]
nmin <-  t10[3:nrow(t10), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t10[3:nrow(t10), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]
                  
# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.10 <- growth.modGomp(input = pctrl, output.name = "T10.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.10 <- growth.modGomp(input = nmin, output.name = "T10.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.10 <- growth.modGomp(input = min, output.name = "T10.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t10.out.ctrl <- read.table("../output/T10.ctrl.parms.txt", sep = ",", header=TRUE)
t10.out.nmin <- read.table("../output/T10.nmin.parms.txt", sep = ",", header=TRUE)
t10.out.min <- read.table("../output/T10.min.parms.txt", sep = ",", header=TRUE)
t10.parms <- rbind(t10.out.nmin, t10.out.min, t10.out.ctrl)
t10.parm.ord <- t10.parms[mixedorder(t10.parms$Curve),]
treats.10 <- read.csv("../data/treatments_T10.csv")
t10.treats <- cbind(t10.parm.ord, treats.10)
t10.treats$Curve == t10.treats$well


# t20  = day 20
t20 <- read.csv("../data/T20.csv")

# Change times to numeric
t20$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t20$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t20[3:nrow(t20), c(1,2,12,22,32,42,52)]
pctrl <- t20[3:nrow(t20), c(1,3,13,23,33,43,53)]
nmin <-  t20[3:nrow(t20), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t20[3:nrow(t20), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]
                  
# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.20 <- growth.modGomp(input = pctrl, output.name = "T20.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.20 <- growth.modGomp(input = nmin, output.name = "T20.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.20 <- growth.modGomp(input = min, output.name = "T20.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t20.out.ctrl <- read.table("../output/T20.ctrl.parms.txt", sep = ",", header=TRUE)
t20.out.nmin <- read.table("../output/T20.nmin.parms.txt", sep = ",", header=TRUE)
t20.out.min <- read.table("../output/T20.min.parms.txt", sep = ",", header=TRUE)
t20.parms <- rbind(t20.out.nmin, t20.out.min, t20.out.ctrl)
t20.parm.ord <- t20.parms[mixedorder(t20.parms$Curve),]
treats.20 <- read.csv("../data/treatments_T20.csv")
t20.treats <- cbind(t20.parm.ord, treats.20)
t20.treats <- t20.treats[which(t20.treats$cell != "nm"),]
t20.treats$Curve == t20.treats$well


# Redo t20  = day 20 (nonmin only)
t20.redo.nm <- read.csv("../data/T20.redo.nm.csv")

# Change times to numeric
t20.redo.nm$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t20.redo.nm$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t20.redo.nm[3:nrow(t20.redo.nm), c(1,2,8,14,20,26,32)]
pctrl <- t20.redo.nm[3:nrow(t20.redo.nm), c(1,3,9,15,21,27,33)]
nmin <-  t20.redo.nm[3:nrow(t20.redo.nm), 
             c(1,4,10,16,22,28,34,
               5,11,17,23,29,35,
               6,12,18,24,30,36,
               7,13,19,25,31,37)]

# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.20 <- growth.modGomp(input = pctrl, output.name = "T20.redo.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.20 <- growth.modGomp(input = nmin, output.name = "T20.redo.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t20.redo.out.ctrl <- read.table("../output/T20.redo.ctrl.parms.txt", sep = ",", header=TRUE)
t20.redo.out.nmin <- read.table("../output/T20.redo.nmin.parms.txt", sep = ",", header=TRUE)
t20.redo.parms <- rbind(t20.redo.out.nmin, t20.redo.out.ctrl)
t20.redo.parm.ord <- t20.redo.parms[mixedorder(t20.redo.parms$Curve),]
treats.20.redo <- read.csv("../data/treatments_T20.redo.nmin.csv")
t20.redo.treats <- cbind(t20.redo.parm.ord, treats.20.redo)
t20.redo.treats$Curve == t20.redo.treats$well
# add small unit to distinguish from non-redone
#t20.redo.treats$day <- t20.redo.treats$day + 0.5


# t30  = day 30
t30 <- read.csv("../data/T30.csv")

# Change times to numeric
t30$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t30$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t30[3:nrow(t30), c(1,2,12,22,32,42,52)]
pctrl <- t30[3:nrow(t30), c(1,3,13,23,33,43,53)]
nmin <-  t30[3:nrow(t30), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t30[3:nrow(t30), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]
                  
# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.30 <- growth.modGomp(input = pctrl, output.name = "T30.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.30 <- growth.modGomp(input = nmin, output.name = "T30.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.30 <- growth.modGomp(input = min, output.name = "T30.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t30.out.ctrl <- read.table("../output/T30.ctrl.parms.txt", sep = ",", header=TRUE)
t30.out.nmin <- read.table("../output/T30.nmin.parms.txt", sep = ",", header=TRUE)
t30.out.min <- read.table("../output/T30.min.parms.txt", sep = ",", header=TRUE)
t30.parms <- rbind(t30.out.nmin, t30.out.min, t30.out.ctrl)
t30.parm.ord <- t30.parms[mixedorder(t30.parms$Curve),]
treats.30 <- read.csv("../data/treatments_T30.csv")
t30.treats <- cbind(t30.parm.ord, treats.30)
t30.treats$Curve == t30.treats$well


# t40  = day 40
t40 <- read.csv("../data/T40.csv")

# Change times to numeric
t40$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t40$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t40[3:nrow(t40), c(1,2,12,22,32,42,52)]
pctrl <- t40[3:nrow(t40), c(1,3,13,23,33,43,53)]
nmin <-  t40[3:nrow(t40), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t40[3:nrow(t40), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]
                  
# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.40 <- growth.modGomp(input = pctrl, output.name = "T40.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.40 <- growth.modGomp(input = nmin, output.name = "T40.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.40 <- growth.modGomp(input = min, output.name = "T40.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t40.out.ctrl <- read.table("../output/T40.ctrl.parms.txt", sep = ",", header=TRUE)
t40.out.nmin <- read.table("../output/T40.nmin.parms.txt", sep = ",", header=TRUE)
t40.out.min <- read.table("../output/T40.min.parms.txt", sep = ",", header=TRUE)
t40.parms <- rbind(t40.out.nmin, t40.out.min, t40.out.ctrl)
t40.parm.ord <- t40.parms[mixedorder(t40.parms$Curve),]
treats.40 <- read.csv("../data/treatments_T40.csv")
t40.treats <- cbind(t40.parm.ord, treats.40)
t40.treats$Curve == t40.treats$well


# t50  = day 50
t50 <- read.csv("../data/T50.csv")

# Change times to numeric
t50$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t50$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t50[3:nrow(t50), c(1,2,12,22,32,42,52)]
pctrl <- t50[3:nrow(t50), c(1,3,13,23,33,43,53)]
nmin <-  t50[3:nrow(t50), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t50[3:nrow(t50), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]
                  
# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.50 <- growth.modGomp(input = pctrl, output.name = "T50.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.50 <- growth.modGomp(input = nmin, output.name = "T50.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.50 <- growth.modGomp(input = min, output.name = "T50.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t50.out.ctrl <- read.table("../output/T50.ctrl.parms.txt", sep = ",", header=TRUE)
t50.out.nmin <- read.table("../output/T50.nmin.parms.txt", sep = ",", header=TRUE)
t50.out.min <- read.table("../output/T50.min.parms.txt", sep = ",", header=TRUE)
t50.parms <- rbind(t50.out.nmin, t50.out.min, t50.out.ctrl)
t50.parm.ord <- t50.parms[mixedorder(t50.parms$Curve),]
treats.50 <- read.csv("../data/treatments_T50.csv")
t50.treats <- cbind(t50.parm.ord, treats.50)
t50.treats$Curve == t50.treats$well


# t60  = day 60
# No JCVI positive control in this batch
t60 <- read.csv("../data/T60.csv")

# Change times to numeric
t60$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t60$Time))
head(t60, header = T)

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t60[3:nrow(t60), c(1,2,12,22,32,42,52)]
pctrl <- t60[3:nrow(t60), c(1,3,13,23,33,43,53)]
nmin <-  t60[3:nrow(t60), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t60[3:nrow(t60), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]

# Run Gompertz
#ctrl.gomp.60 <- growth.modGomp(input = pctrl, output.name = "T60.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.60 <- growth.modGomp(input = nmin, output.name = "T60.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.60 <- growth.modGomp(input = min, output.name = "T60.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t60.out.ctrl <- read.table("../output/T60.ctrl.parms.txt", sep = ",", header=TRUE)
t60.out.nmin <- read.table("../output/T60.nmin.parms.txt", sep = ",", header=TRUE)
t60.out.min <- read.table("../output/T60.min.parms.txt", sep = ",", header=TRUE)
t60.parms <- rbind(t60.out.nmin, t60.out.min, t60.out.ctrl)
t60.parm.ord <- t60.parms[mixedorder(t60.parms$Curve),]
treats.60 <- read.csv("../data/treatments_T60.csv")
t60.treats <- cbind(t60.parm.ord, treats.60)
t60.treats$Curve == t60.treats$well


# Redo t60  = day 60 (nonmin only)
t60.redo.nm <- read.csv("../data/T60.redo.nm.csv")

# Change times to numeric
t60.redo.nm$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t60.redo.nm$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t60.redo.nm[3:nrow(t60.redo.nm), c(1,2,8,14,20,26,32)]
pctrl <- t60.redo.nm[3:nrow(t60.redo.nm), c(1,3,9,15,21,27,33)]
nmin <-  t60.redo.nm[3:nrow(t60.redo.nm), 
             c(1,4,10,16,22,28,34,
               5,11,17,23,29,35,
               6,12,18,24,30,36,
               7,13,19,25,31,37)]

# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.60 <- growth.modGomp(input = pctrl, output.name = "T60.redo.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.60 <- growth.modGomp(input = nmin, output.name = "T60.redo.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t60.redo.out.ctrl <- read.table("../output/T60.redo.ctrl.parms.txt", sep = ",", header=TRUE)
t60.redo.out.nmin <- read.table("../output/T60.redo.nmin.parms.txt", sep = ",", header=TRUE)
t60.redo.parms <- rbind(t60.redo.out.nmin, t60.redo.out.ctrl)
t60.redo.parm.ord <- t60.redo.parms[mixedorder(t60.redo.parms$Curve),]
treats.60.redo <- read.csv("../data/treatments_T60.redo.nmin.csv")
t60.redo.treats <- cbind(t60.redo.parm.ord, treats.60.redo)
t60.redo.treats$Curve == t60.redo.treats$well
# add small unit to distinguish from non-redone
#t60.redo.treats$day <- t60.redo.treats$day + 0.5


# t80  = day 80
t80 <- read.csv("../data/T80.csv")

# Change times to numeric
t80$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t80$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t80[3:nrow(t80), c(1,2,12,22,32,42,52)]
pctrl <- t80[3:nrow(t80), c(1,3,13,23,33,43,53)]
nmin <-  t80[3:nrow(t80), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t80[3:nrow(t80), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]
                  
# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.80 <- growth.modGomp(input = pctrl, output.name = "T80.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.80 <- growth.modGomp(input = nmin, output.name = "T80.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.80 <- growth.modGomp(input = min, output.name = "T80.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t80.out.ctrl <- read.table("../output/T80.ctrl.parms.txt", sep = ",", header=TRUE)
t80.out.nmin <- read.table("../output/T80.nmin.parms.txt", sep = ",", header=TRUE)
t80.out.min <- read.table("../output/T80.min.parms.txt", sep = ",", header=TRUE)
t80.parms <- rbind(t80.out.nmin, t80.out.min, t80.out.ctrl)
t80.parm.ord <- t80.parms[mixedorder(t80.parms$Curve),]
treats.80 <- read.csv("../data/treatments_T80.csv")
t80.treats <- cbind(t80.parm.ord, treats.80)
t80.treats$Curve == t80.treats$well


# t100  = day 100
# No JCVI positive control in this batch

t100 <- read.csv("../data/T100.csv")

# Change times to numeric
t100$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t100$Time))
head(t100, header = T)

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t100[3:nrow(t100), c(1,2,12,22,32,42,52)]
pctrl <- t100[3:nrow(t100), c(1,3,13,23,33,43,53)]
nmin <-  t100[3:nrow(t100), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t100[3:nrow(t100), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]

# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.100 <- growth.modGomp(input = pctrl, output.name = "T100.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.100 <- growth.modGomp(input = nmin, output.name = "T100.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.100 <- growth.modGomp(input = min, output.name = "T100.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t100.out.ctrl <- read.table("../output/T100.ctrl.parms.txt", sep = ",", header=TRUE)
t100.out.nmin <- read.table("../output/T100.nmin.parms.txt", sep = ",", header=TRUE)
t100.out.min <- read.table("../output/T100.min.parms.txt", sep = ",", header=TRUE)
t100.parms <- rbind(t100.out.nmin, t100.out.min, t100.out.ctrl)
t100.parm.ord <- t100.parms[mixedorder(t100.parms$Curve),]
treats.100 <- read.csv("../data/treatments_T100.csv")
t100.treats <- cbind(t100.parm.ord, treats.100)
t100.treats <- t100.treats[which(t100.treats$cell != "nm"),]
t100.treats$Curve == t100.treats$well


# Redo t100  = day 100 (nonmin)
t100.redo.nm <- read.csv("../data/T100.redo.nm.csv")

# Change times to numeric
t100.redo.nm$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t100.redo.nm$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t100.redo.nm[3:nrow(t100.redo.nm), c(1,2,8,14,20,26,32)]
pctrl <- t100.redo.nm[3:nrow(t100.redo.nm), c(1,3,9,15,21,27,33)]
nmin <-  t100.redo.nm[3:nrow(t100.redo.nm), 
             c(1,4,10,16,22,28,34,
               5,11,17,23,29,35,
               6,12,18,24,30,36,
               7,13,19,25,31,37)]

# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.100 <- growth.modGomp(input = pctrl, output.name = "T100.redo.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.100 <- growth.modGomp(input = nmin, output.name = "T100.redo.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t100.redo.out.ctrl <- read.table("../output/T100.redo.ctrl.parms.txt", sep = ",", header=TRUE)
t100.redo.out.nmin <- read.table("../output/T100.redo.nmin.parms.txt", sep = ",", header=TRUE)
t100.redo.parms <- rbind(t100.redo.out.nmin, t100.redo.out.ctrl)
t100.redo.parm.ord <- t100.redo.parms[mixedorder(t100.redo.parms$Curve),]
treats.100.redo <- read.csv("../data/treatments_T100.redo.nmin.csv")
t100.redo.treats <- cbind(t100.redo.parm.ord, treats.100.redo)
t100.redo.treats$Curve == t100.redo.treats$well
# add small unit to distinguish from non-redone
#t100.redo.treats$day <- t100.redo.treats$day + 0.5


# t120  = day 120
t120 <- read.csv("../data/T120.csv")

# Change times to numeric
t120$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t120$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t120[3:nrow(t120), c(1,2,12,22,32,42,52)]
pctrl <- t120[3:nrow(t120), c(1,3,13,23,33,43,53)]
nmin <-  t120[3:nrow(t120), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t120[3:nrow(t120), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]
                  
# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.120 <- growth.modGomp(input = pctrl, output.name = "T120.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.120 <- growth.modGomp(input = nmin, output.name = "T120.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.120 <- growth.modGomp(input = min, output.name = "T120.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t120.out.ctrl <- read.table("../output/T120.ctrl.parms.txt", sep = ",", header=TRUE)
t120.out.nmin <- read.table("../output/T120.nmin.parms.txt", sep = ",", header=TRUE)
t120.out.min <- read.table("../output/T120.min.parms.txt", sep = ",", header=TRUE)
t120.parms <- rbind(t120.out.nmin, t120.out.min, t120.out.ctrl)
t120.parm.ord <- t120.parms[mixedorder(t120.parms$Curve),]
# removed column 10 and 11 (B-G) because cells didn't grow in plate
treats.120 <- read.csv("../data/treatments_T120.csv")
t120.treats <- cbind(t120.parm.ord, treats.120)
t120.treats$Curve == t120.treats$well



# t140  = day 140
t140 <- read.csv("../data/T140.csv")

# Change times to numeric
t140$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t140$Time))
head(t140, header = T)

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t140[3:nrow(t140), c(1,2,12,22,32,42,52)]
pctrl <- t140[3:nrow(t140), c(1,3,13,23,33,43,53)]
nmin <-  t140[3:nrow(t140), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t140[3:nrow(t140), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]

# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.140 <- growth.modGomp(input = pctrl, output.name = "T140.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.140 <- growth.modGomp(input = nmin, output.name = "T140.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.140 <- growth.modGomp(input = min, output.name = "T140.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t140.out.ctrl <- read.table("../output/T140.ctrl.parms.txt", sep = ",", header=TRUE)
t140.out.nmin <- read.table("../output/T140.nmin.parms.txt", sep = ",", header=TRUE)
t140.out.min <- read.table("../output/T140.min.parms.txt", sep = ",", header=TRUE)
t140.parms <- rbind(t140.out.nmin, t140.out.min, t140.out.ctrl)
t140.parm.ord <- t140.parms[mixedorder(t140.parms$Curve),]
treats.140 <- read.csv("../data/treatments_T140.csv")
t140.treats.full <- cbind(t140.parm.ord, treats.140)
t140.treats <- t140.treats.full[which(t140.treats.full$cell != "nm"),]
t140.treats$Curve == t140.treats$well



# Redo t140  = day 140 (nonmin only)
t140.redo.nm <- read.csv("../data/T140.redo.nm.csv")

# Change times to numeric
t140.redo.nm$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t140.redo.nm$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t140.redo.nm[3:nrow(t140.redo.nm), c(1,2,8,14,20,26,32)]
pctrl <- t140.redo.nm[3:nrow(t140.redo.nm), c(1,3,9,15,21,27,33)]
nmin <-  t140.redo.nm[3:nrow(t140.redo.nm), 
             c(1,4,10,16,22,28,34,
               5,11,17,23,29,35,
               6,12,18,24,30,36,
               7,13,19,25,31,37)]

# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.140 <- growth.modGomp(input = pctrl, output.name = "T140.redo.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.140 <- growth.modGomp(input = nmin, output.name = "T140.redo.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t140.redo.out.ctrl <- read.table("../output/T140.redo.ctrl.parms.txt", sep = ",", header=TRUE)
t140.redo.out.nmin <- read.table("../output/T140.redo.nmin.parms.txt", sep = ",", header=TRUE)
t140.redo.parms <- rbind(t140.redo.out.nmin, t140.redo.out.ctrl)
t140.redo.parm.ord <- t140.redo.parms[mixedorder(t140.redo.parms$Curve),]
treats.140.redo <- read.csv("../data/treatments_T140.redo.nmin.csv")
t140.redo.treats <- cbind(t140.redo.parm.ord, treats.140.redo)
t140.redo.treats$Curve == t140.redo.treats$well
# add small unit to distinguish from non-redone
#t140.redo.treats$day <- t140.redo.treats$day + 0.5


# 140 average
t140.ave <- rbind(t140.treats.full,t140.redo.treats)

# t160  = day 160
t160 <- read.csv("../data/T160.csv")

# Change times to numeric
t160$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t160$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t160[3:nrow(t160), c(1,2,12,22,32,42,52)]
pctrl <- t160[3:nrow(t160), c(1,3,13,23,33,43,53)]
nmin <-  t160[3:nrow(t160), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t160[3:nrow(t160), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]
                  
# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.160 <- growth.modGomp(input = pctrl, output.name = "T160.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.160 <- growth.modGomp(input = nmin, output.name = "T160.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.160 <- growth.modGomp(input = min, output.name = "T160.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t160.out.ctrl <- read.table("../output/T160.ctrl.parms.txt", sep = ",", header=TRUE)
t160.out.nmin <- read.table("../output/T160.nmin.parms.txt", sep = ",", header=TRUE)
t160.out.min <- read.table("../output/T160.min.parms.txt", sep = ",", header=TRUE)
t160.parms <- rbind(t160.out.nmin, t160.out.min, t160.out.ctrl)
t160.parm.ord <- t160.parms[mixedorder(t160.parms$Curve),]
treats.160 <- read.csv("../data/treatments_T160.csv")
t160.treats <- cbind(t160.parm.ord, treats.160)
t160.treats$Curve == t160.treats$well


# t180  = day 180
t180 <- read.csv("../data/T180.csv")

# Change times to numeric
t180$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t180$Time))
head(t180, header = T)

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t180[3:nrow(t180), c(1,2,12,22,32,42,52)]
pctrl <- t180[3:nrow(t180), c(1,3,13,23,33,43,53)]
nmin <-  t180[3:nrow(t180), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t180[3:nrow(t180), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]

# Run Gompertz
#ctrl.gomp.180 <- growth.modGomp(input = pctrl, output.name = "T180.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.180 <- growth.modGomp(input = nmin, output.name = "T180.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.180 <- growth.modGomp(input = min, output.name = "T180.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t180.out.ctrl <- read.table("../output/T180.ctrl.parms.txt", sep = ",", header=TRUE)
t180.out.nmin <- read.table("../output/T180.nmin.parms.txt", sep = ",", header=TRUE)
t180.out.min <- read.table("../output/T180.min.parms.txt", sep = ",", header=TRUE)
t180.parms <- rbind(t180.out.nmin, t180.out.min, t180.out.ctrl)
t180.parm.ord <- t180.parms[mixedorder(t180.parms$Curve),]
treats.180 <- read.csv("../data/treatments_T180.csv")
t180.treats <- cbind(t180.parm.ord, treats.180)
t180.treats$Curve == t180.treats$well


# t200  = day 200
t200 <- read.csv("../data/T200.csv")

# Change times to numeric
t200$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t200$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t200[3:nrow(t200), c(1,2,12,22,32,42,52)]
pctrl <- t200[3:nrow(t200), c(1,3,13,23,33,43,53)]
nmin <-  t200[3:nrow(t200), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t200[3:nrow(t200), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]
                  
# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.200 <- growth.modGomp(input = pctrl, output.name = "T200.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.200 <- growth.modGomp(input = nmin, output.name = "T200.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.200 <- growth.modGomp(input = min, output.name = "T200.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t200.out.ctrl <- read.table("../output/T200.ctrl.parms.txt", sep = ",", header=TRUE)
t200.out.nmin <- read.table("../output/T200.nmin.parms.txt", sep = ",", header=TRUE)
t200.out.min <- read.table("../output/T200.min.parms.txt", sep = ",", header=TRUE)
t200.parms <- rbind(t200.out.nmin, t200.out.min, t200.out.ctrl)
t200.parm.ord <- t200.parms[mixedorder(t200.parms$Curve),]
treats.200 <- read.csv("../data/treatments_T200.csv")
t200.treats <- cbind(t200.parm.ord, treats.200)
t200.treats$Curve == t200.treats$well


# t220  = day 220
t220 <- read.csv("../data/T220.csv")

# Change times to numeric
t220$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t220$Time))
head(t220, header = T)

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t220[3:nrow(t220), c(1,2,12,22,32,42,52)]
pctrl <- t220[3:nrow(t220), c(1,3,13,23,33,43,53)]
nmin <-  t220[3:nrow(t220), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t220[3:nrow(t220), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]

# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.220 <- growth.modGomp(input = pctrl, output.name = "T220.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.220 <- growth.modGomp(input = nmin, output.name = "T220.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.220 <- growth.modGomp(input = min, output.name = "T220.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t220.out.ctrl <- read.table("../output/T220.ctrl.parms.txt", sep = ",", header=TRUE)
t220.out.nmin <- read.table("../output/T220.nmin.parms.txt", sep = ",", header=TRUE)
t220.out.min <- read.table("../output/T220.min.parms.txt", sep = ",", header=TRUE)
t220.parms <- rbind(t220.out.nmin, t220.out.min, t220.out.ctrl)
t220.parm.ord <- t220.parms[mixedorder(t220.parms$Curve),]
treats.220 <- read.csv("../data/treatments_T220.csv")
t220.treats <- cbind(t220.parm.ord, treats.220)
t220.treats$Curve == t220.treats$well


# t240  = day 240
t240 <- read.csv("../data/T240.csv")

# Change times to numeric
t240$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t240$Time))

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t240[3:nrow(t240), c(1,2,12,22,32,42,52)]
pctrl <- t240[3:nrow(t240), c(1,3,13,23,33,43,53)]
nmin <-  t240[3:nrow(t240), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t240[3:nrow(t240), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]
                  
# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.240 <- growth.modGomp(input = pctrl, output.name = "T240.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.240 <- growth.modGomp(input = nmin, output.name = "T240.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.240 <- growth.modGomp(input = min, output.name = "T240.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t240.out.ctrl <- read.table("../output/T240.ctrl.parms.txt", sep = ",", header=TRUE)
t240.out.nmin <- read.table("../output/T240.nmin.parms.txt", sep = ",", header=TRUE)
t240.out.min <- read.table("../output/T240.min.parms.txt", sep = ",", header=TRUE)
t240.parms <- rbind(t240.out.nmin, t240.out.min, t240.out.ctrl)
t240.parm.ord <- t240.parms[mixedorder(t240.parms$Curve),]
# removed column 10 (B-G) because cells didn't grow in plate; also F9 and G9
treats.240 <- read.csv("../data/treatments_T240.csv")
t240.treats <- cbind(t240.parm.ord, treats.240)
t240.treats$Curve == t240.treats$well


# 260  = day 260
t260 <- read.csv("../data/T260.csv")

# Change times to numeric
t260$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t260$Time))
head(t260, header = T)

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t260[3:nrow(t260), c(1,2,12,22,32,42,52)]
pctrl <- t260[3:nrow(t260), c(1,3,13,23,33,43,53)]
nmin <-  t260[3:nrow(t260), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t260[3:nrow(t260), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]

# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.260 <- growth.modGomp(input = pctrl, output.name = "T260.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.260 <- growth.modGomp(input = nmin, output.name = "T260.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.260 <- growth.modGomp(input = min, output.name = "T260.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t260.out.ctrl <- read.table("../output/T260.ctrl.parms.txt", sep = ",", header=TRUE)
t260.out.nmin <- read.table("../output/T260.nmin.parms.txt", sep = ",", header=TRUE)
t260.out.min <- read.table("../output/T260.min.parms.txt", sep = ",", header=TRUE)
t260.parms <- rbind(t260.out.nmin, t260.out.min, t260.out.ctrl)
t260.parm.ord <- t260.parms[mixedorder(t260.parms$Curve),]
treats.260 <- read.csv("../data/treatments_T260.csv")
t260.treats <- cbind(t260.parm.ord, treats.260)
t260.treats$Curve == t260.treats$well


# t280  = day 280
t280 <- read.csv("../data/T280.csv")

# Change times to numeric
t280$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t280$Time))
head(t280, header = T)

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t280[3:nrow(t280), c(1,2,12,22,32,42,52)]
pctrl <- t280[3:nrow(t280), c(1,3,13,23,33,43,53)]
nmin <-  t280[3:nrow(t280), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t280[3:nrow(t280), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]

# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.280 <- growth.modGomp(input = pctrl, output.name = "T280.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.280 <- growth.modGomp(input = nmin, output.name = "T280.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.280 <- growth.modGomp(input = min, output.name = "T280.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t280.out.ctrl <- read.table("../output/T280.ctrl.parms.txt", sep = ",", header=TRUE)
t280.out.nmin <- read.table("../output/T280.nmin.parms.txt", sep = ",", header=TRUE)
t280.out.min <- read.table("../output/T280.min.parms.txt", sep = ",", header=TRUE)
t280.parms <- rbind(t280.out.nmin, t280.out.min, t280.out.ctrl)
t280.parm.ord <- t280.parms[mixedorder(t280.parms$Curve),]
treats.280 <- read.csv("../data/treatments_T280.csv")
t280.treats <- cbind(t280.parm.ord, treats.280)
t280.treats$Curve == t280.treats$well


# t300  = day 300
t300 <- read.csv("../data/T300.csv")

# Change times to numeric
t300$Time <- as.numeric(sub("^(\\d+):(\\d+).*", "\\1.\\2", t300$Time))
head(t300, header = T)

# Pull out wells: controls, non-minimal, and minimal cells
nctrl <- t300[3:nrow(t300), c(1,2,12,22,32,42,52)]
pctrl <- t300[3:nrow(t300), c(1,3,13,23,33,43,53)]
nmin <-  t300[3:nrow(t300), 
             c(1,4,14,24,34,44,54,
                 5,15,25,35,45,55,
                 6,16,26,36,46,56,
                 7,17,27,37,47,57)]
min <- t260[3:nrow(t300), 
            c(1,8,18,28,38,48,58,
                9,19,29,39,49,59,
                10,20,30,40,50,60,
                11,21,31,41,51,61)]

# Run Gompertz (only need to run once then comment out)

#ctrl.gomp.300 <- growth.modGomp(input = pctrl, output.name = "T300.ctrl.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#nmin.gomp.300 <- growth.modGomp(input = nmin, output.name = "T300.nmin.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)
#min.gomp.300 <- growth.modGomp(input = min, output.name = "T300.min.parms", 
#               synergy = F, temp = F, smooth = T, trim = T)

# Merge and sort parameters
t300.out.ctrl <- read.table("../output/T300.ctrl.parms.txt", sep = ",", header=TRUE)
t300.out.nmin <- read.table("../output/T300.nmin.parms.txt", sep = ",", header=TRUE)
t300.out.min <- read.table("../output/T300.min.parms.txt", sep = ",", header=TRUE)
t300.parms <- rbind(t300.out.nmin, t300.out.min, t300.out.ctrl)
t300.parm.ord <- t300.parms[mixedorder(t300.parms$Curve),]
treats.300 <- read.csv("../data/treatments_T300.csv")
t300.treats <- cbind(t300.parm.ord, treats.300)
t300.treats$Curve == t300.treats$well


# put them all together
# or remove certain problem dates (e.g., 180)
# parse out nm vs m below
parms <-rbind(t0.orig.treats, t10.treats, t20.treats, 
              t20.redo.treats, t30.treats, t40.treats, t50.treats, t60.treats, t60.redo.treats, 
              t80.treats, t100.treats, t100.redo.treats, t120.treats, 
              t140.ave, t160.treats, t200.treats, t220.treats, 
              t240.treats, t260.treats, t280.treats, t300.treats)


gen <- round((1997/300)*parms$day,0)
parms <-cbind(parms, gen)

parms <- parms[, c(1,3,4,5,13,14,15,16,17,20)]
```


# Summarize growth minimal and non-minimal cell across time
```{r}

# select "nm" and "m" then take means of technical replicates
ts.raw <- filter(parms, cell == c("nm","m")) %>%
  dplyr::select(day, gen, cell, biorep, A, umax, L)

ts <- ts.raw %>%
  group_by(day, gen, cell, biorep) %>%
  dplyr::summarise(A = mean(A), umax = mean(umax), lag = mean(L))

ts.nm <- filter(ts, cell == "nm") %>%
  dplyr::select(day, gen, biorep, cell, A, umax, lag)

ts.m <- filter(ts, cell == "m") %>%
  dplyr::select(day, gen, biorep, cell, A, umax, lag)

  
ts.nm.mean <- ts.nm %>%
   group_by(gen, day) %>%
   summarise(A = mean(A), umax = mean(umax), lag = mean(lag))
 ts.nm.mean <- as.data.frame(ts.nm.mean) 
 
 ts.m.mean <- ts.m %>%
   group_by(gen, day) %>%
   summarise(A = mean(A), umax = mean(umax), lag = mean(lag))
 ts.m.mean <- as.data.frame(ts.m.mean) 
 
 ts.mean <- ts %>%
   group_by(gen, day, cell) %>%
   summarise(A = mean(A), umax = mean(umax), lag = mean(lag))
 ts.mean <- as.data.frame(ts.mean) 

# making day zeros for all replicate populations
ts.rem0 <- ts[which(ts$day != "0"), ] # non zero time points?
ts.mean.T0.reps <-ts.mean[which(ts.mean$day == "0"),] # mean of tech reps on day 0
ts.mean.T0.reps[rep(seq_len(nrow(ts.mean.T0.reps)), each = 4), ] # rep the tech means for bioreps
ts.means.T0.bioreps <- c(5,1,6,2,7,3,8,4) # order for t0 reps
ts.mean.T0 <- cbind(ts.mean.T0.reps, ts.means.T0.bioreps) # ignore warning
colnames(ts.mean.T0)[7] <- "biorep"
ts.mean.T0 <- ts.mean.T0[,c(1,2,3,7,4,5,6)]
ts.mod <- rbind(ts.mean.T0, ts.rem0) # merges t0 with other time points


### stats

data <- as.data.frame(ts.mod) # all observations

gen <- data[,1]
day <- data[,2]
cell <- data[,3]
biorep <- data[,4]
umax <- data[,6]

#http://rstudio-pubs-static.s3.amazonaws.com/25354_2eeb42bf56d44cbc9ee217535aa962aa.html


#data <- as.data.frame(ts.mean) # means
#mod1 <- lm(data$umax ~ data$day * data$cell, data = data)
#mod1 <- lm(umax ~ day * cell, data = data)
#mod2 <- lmer(data$umax ~ (1 | biorep) + (data$day * data$cell), data = data) #lme4
mod2 <- lme(umax ~ (day * cell), random = ~ 1 | biorep, data = data)
# mod3 <- lme(umax ~ (day * cell), random = ~ cell | biorep, data = data) # another way to depict
# mod5 <- lme(umax ~ (day * cell), random = ~1 + cell | biorep, data = data) 
# mod4 <- lme(umax ~ (day * cell), random = list(biorep = pdDiag(~ cell)), data = data)


sum <- summary(mod2)
tabl <-sum$tTable
#confint(mod2)
aov(mod2)
#library(car)
#anova.lme(mod2) # same as anova()
Anova(mod2)
anova(mod2, test = "Chi")
r.squaredGLMM(mod2) #from MuMIn package; marginal (just fixed) and conditional (both)
CI <- intervals(mod2, which = "fixed")







#plot(mod2, biorep ~ resid(.), abline = 0 )
#plot(mod2, resid(., type = "pearson") ~ fitted(.) | biorep, id = 0.05, 
#     adj = -0.3, pch = 20, col = "gray40")









data.min <- as.data.frame(ts.m.mean)
mod2 <- lm(data.min$umax ~ data.min$day)
summary(mod2)

data.nmin <- as.data.frame(ts.nm.mean)
mod3 <- lm(data.nmin$umax ~ data.nmin$day)
summary(mod3)



regs <- ts %>%
  group_by(biorep) %>%
  group_map(~ broom::tidy(lm(umax ~ day, data = .x)))

regs.parms <- lapply(regs, `[[`, 2)
regs.parms <- unlist(regs.parms)
nm.slopes <- regs.parms[c(4,6,8,10)]
nm.int <- regs.parms[c(3,5,7,9)]
m.slopes <- regs.parms[c(12,14,16,18)]
m.int <- regs.parms[c(111,13,15,17)]

slope.test <- t.test(nm.slopes, m.slopes)
# t = 1.3959, df = 3.1191, p-value = 0.2539
intercept.test <- t.test(nm.int, m.int)
# t = 15.315, df = 4.1688, p-value = 8.028e-05


ts <- data.frame(ts)
#ts <- data.frame(ts,umax=unlist(umax), biorep=unlist(biorep))
time <- ts[,1]
umax <- ts[,6]
cell <- ts[,3]
biorep <- ts[,4]


# Create Dummy Variables by Strain
D1 <- (ts$cell == "nm")*1
fit <- lm(ts$umax ~ time + D1 + time*D1)
fit <- lm(ts$umax ~ time + D1 + time:biorep + time*D1)
summary(fit)

#mixed effect model?
# https://cran.r-project.org/web/packages/emmeans/vignettes/interactions.html
```



# Initiate figure
```{r}

png(filename="~/GitHub/MinimalCell/scripts/6.GrowthRates/output/TimeSeries.png",
    width = 1200, height = 1200, res = 96*2) 

plot.new()
par(mar = c(7, 7, 5, 7))

# Add non-minimal points
plot(jitter(ts.nm$day,1), ts.nm$umax, xlim = c(-10, 320), 
     ylim = c(0.02, 0.2), type = "p", pch = 21, bg = "blue", 
     col = "blue", cex = 1.25, ylab = "", xlab = "", 
     cex.lab = 1.5, las = 1, lwd = 2, yaxt = "n", xaxt = "n")
box(lwd=2)
  
plot_model(mod2)

# Add minimal points
points(jitter(ts.m$day), ts.m$umax, pch = 21, 
       bg = "red", col = "red", lwd = 2, cex = 1.25)


install.packages("sjPlot")
library("sjPlot")


  ts.nm.mean$day, ts.nm.mean$umax, xlim = c(-10, 320), 
     ylim = c(0.02, 0.2), type = "p", pch = 21, bg = "blue", 
     col = "blue", cex = 2, ylab = "", xlab = "", 
     cex.lab = 1.5, las = 1, lwd = 2, yaxt = "n", xaxt = "n")
box(lwd=2)

plot(ts.nm.mean$day, ts.nm.mean$umax, xlim = c(-10, 320), 
     ylim = c(0.02, 0.2), type = "p", pch = 21, bg = "blue", 
     col = "blue", cex = 2, ylab = "", xlab = "", 
     cex.lab = 1.5, las = 1, lwd = 2, yaxt = "n", xaxt = "n")
box(lwd=2)




# Add minimal points
points(ts.m.mean$day, ts.m.mean$umax, pch = 21, 
       bg = "red", col = "red", lwd = 2, cex = 2)

# Add individual obs for each population

nm.1 <- filter(ts.mod, cell == "nm" & biorep == "1") %>%
  dplyr::select(day, cell, gen, biorep, A, umax, lag)
points(nm.1$day, nm.1$umax, pch = 21, col = "lightblue", bg = "lightblue", cex = 1)

nm.2 <- filter(ts.mod, cell == "nm" & biorep == "2") %>%
  dplyr::select(day, cell, gen, biorep, A, umax, lag)
points(nm.2$day, nm.2$umax, pch = 21, col = "lightblue", bg = "lightblue", cex = 1)

nm.3 <- filter(ts.mod, cell == "nm" & biorep == "3") %>%
  dplyr::select(day, cell, gen, biorep, A, umax, lag)
points(nm.3$day, nm.3$umax, pch = 21, col = "lightblue", bg = "lightblue", cex = 1)

nm.4 <- filter(ts.mod, cell == "nm" & biorep == "4") %>%
  dplyr::select(day, cell, gen, biorep, A, umax, lag)
points(nm.4$day, nm.4$umax, pch = 21, col = "lightblue", bg = "lightblue", cex = 1)

points(ts.nm.mean$day, ts.nm.mean$umax, pch = 21, bg = "blue", 
     col = "blue", cex = 2)

m.5 <- filter(ts.mod, cell == "m" & biorep == "5") %>%
  dplyr::select(day, cell, gen, biorep, A, umax, lag)
points(m.5$day, m.5$umax, pch = 21, col = "pink", bg = "pink", cex = 1)

m.6 <- filter(ts.mod, cell == "m" & biorep == "6") %>%
  dplyr::select(day, cell, gen, biorep, A, umax, lag)
points(m.6$day, m.6$umax, pch = 21, col = "pink", bg = "pink", cex = 1)

m.7 <- filter(ts.mod, cell == "m" & biorep == "7") %>%
  dplyr::select(day, cell, gen, biorep, A, umax, lag)
points(m.7$day, m.7$umax, pch = 21, col = "pink", bg = "pink", cex = 1)

m.8 <- filter(ts.mod, cell == "m" & biorep == "8") %>%
  dplyr::select(day, cell, gen, biorep, A, umax, lag)
points(m.8$day, m.8$umax, pch = 21, col = "pink", bg = "pink", cex = 1)

points(ts.m.mean$day, ts.m.mean$umax, pch = 21, bg = "red", 
     col = "red", cex = 2)


# Add error bars
#arrows(x0 = non.min.tab$time, y0 = non.min.tab$mean, 
#       y1 = non.min.tab$mean + non.min.tab$sem, 
#       angle = 90, length = 0.1, lwd = 2, col = "blue")
#arrows(x0 = non.min.tab$time, y0 = non.min.tab$mean, 
#       y1 = non.min.tab$mean - non.min.tab$sem, 
#       angle = 90, length=0.1, lwd = 2, col = "blue")
#arrows(x0 = min.tab$time, y0 = min.tab$mean, 
#       y1 = min.tab$mean + min.tab$sem, 
#       angle = 90, length = 0.1, lwd = 2, col = "red")
#arrows(x0 = min.tab$time, y0 = min.tab$mean, 
#       y1 = min.tab$mean - min.tab$sem, 
#       angle = 90, length=0.1, lwd = 2, col = "red")

# Add axes and labels
axis(side = 2, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     labels = c("0.020", "0.125", "0.200"), at = c(0.02,0.125, 0.20))
axis(side = 4, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     at=c(0.02,0.125, 0.20), labels = F)
axis(side = 3, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     at = c(0, 50, 100, 150, 200, 250, 300), labels = F)
axis(side = 1, lwd.ticks = 2, cex.axis = 1.25, las = 1,
     labels = c("0", "50", "100", "150", "200", "250", "300"), at = c(0, 50, 100, 150, 200, 250, 300))

#axis(side = 1, lwd.ticks = 2, cex.axis = 1.25, las = 1,
#     labels = c("Ancestor", "Evolved"), 
#     col.axis = "darkgray", at = c(1, 3))
#mtext(expression('Time'), side = 1,
#      outer = TRUE, cex = 1.5, line = -3.5, adj = 0.45)
#mtext(expression("Maximum growth rate (per day)"), side = 2, 
#      outer = TRUE, cex = 1.5, line = -4, adj = 0.55)

# Add line segments
segments(non.min.tab$time[1], non.min.tab$mean[1], non.min.tab$time[2], 
         non.min.tab$mean[2], col = "blue", lwd = 2)
segments(min.tab$time[1], min.tab$mean[1], min.tab$time[2], 
         min.tab$mean[2], col = "red", lwd = 2)

# Add P-values
#mtext(expression("Timepoint:" ~italic("P")~"= 0.0003"), line = -2.5, cex = 0.80, at = 0.9)
#mtext(expression("Strain:" ~italic("P")~"< 0.0001"), line = -4.0, cex = 0.80, at = 0.75)

# Add strain identifier
#text(3.9, rel.fit.wt$mean[2], labels = "Non-minimal", cex = 1.0)
#text(3.8, rel.fit.min$mean[2], labels = "Minimal", cex = 1.0)

# Close Plot Device
dev.off()
graphics.off()

# Show Plot
img <- readPNG("~~/GitHub/MinimalCell/scripts/6.GrowthRates/output/EndpointFig.png")

grid.raster(img)
```


jcvi.20  <- filter(t20.treats, cell == "jcvi") %>%
  dplyr::select(day, techrep, A, umax, L) %>%
  summarise(A =cv(A), umax = cv(umax), lag = cv(L))

# trying to get CVs for each biorep by cell type
nm.20  <- filter(t20.treats, cell == c("nm","m")) %>%
  dplyr::select(day, biorep, A, umax, L) %>%
  summarise(A =cv(A), umax = cv(umax), lag = cv(L))